# URL Shortener - Architecture Diagram

## ğŸ— System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        FRONTEND (React + Vite)                   â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚   Pages      â”‚  â”‚  Components  â”‚  â”‚    Hooks     â”‚          â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”‚
â”‚  â”‚ â€¢ Index      â”‚  â”‚ â€¢ Analytics  â”‚  â”‚ â€¢ useLinks   â”‚          â”‚
â”‚  â”‚ â€¢ Statistics â”‚  â”‚ â€¢ Dashboard  â”‚  â”‚ â€¢ useAnalyticsâ”‚         â”‚
â”‚  â”‚ â€¢ Redirect   â”‚  â”‚ â€¢ Auth       â”‚  â”‚ â€¢ useDomains â”‚          â”‚
â”‚  â”‚ â€¢ Archives   â”‚  â”‚ â€¢ Shortener  â”‚  â”‚ â€¢ useCampaignsâ”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚      Supabase Client (@supabase/supabase-js)       â”‚         â”‚
â”‚  â”‚      - Auth                                         â”‚         â”‚
â”‚  â”‚      - Database Queries                             â”‚         â”‚
â”‚  â”‚      - Real-time Subscriptions                      â”‚         â”‚
â”‚  â”‚      - Edge Function Invocations                    â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ HTTPS
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SUPABASE BACKEND                            â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Edge Functions (Deno Runtime)                â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  1. track-click                                           â”‚  â”‚
â”‚  â”‚     â€¢ Validates short code                                â”‚  â”‚
â”‚  â”‚     â€¢ Checks password                                     â”‚  â”‚
â”‚  â”‚     â€¢ Fetches geolocation (ipapi.co)                      â”‚  â”‚
â”‚  â”‚     â€¢ Parses user agent                                   â”‚  â”‚
â”‚  â”‚     â€¢ Inserts click record                                â”‚  â”‚
â”‚  â”‚     â€¢ Calls increment_daily_analytics()                   â”‚  â”‚
â”‚  â”‚     â€¢ Returns redirect URL                                â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  2. shorten-url                                           â”‚  â”‚
â”‚  â”‚     â€¢ Validates URL                                       â”‚  â”‚
â”‚  â”‚     â€¢ Generates/validates short code                      â”‚  â”‚
â”‚  â”‚     â€¢ Hashes password (SHA-256)                           â”‚  â”‚
â”‚  â”‚     â€¢ Creates link record                                 â”‚  â”‚
â”‚  â”‚     â€¢ Attaches pixels                                     â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  3. redirect                                              â”‚  â”‚
â”‚  â”‚     â€¢ Calls track-click                                   â”‚  â”‚
â”‚  â”‚     â€¢ Returns HTTP 302 redirect                           â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  4. verify-password                                       â”‚  â”‚
â”‚  â”‚     â€¢ Validates password hash                             â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚                                   â”‚
â”‚                              â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              PostgreSQL Database                          â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  Tables:                                                   â”‚  â”‚
â”‚  â”‚  â€¢ links (36 rows)          - Shortened URLs              â”‚  â”‚
â”‚  â”‚  â€¢ clicks (107 rows)        - Click events                â”‚  â”‚
â”‚  â”‚  â€¢ analytics_daily (19)     - Daily aggregations          â”‚  â”‚
â”‚  â”‚  â€¢ domains (1)              - Custom domains              â”‚  â”‚
â”‚  â”‚  â€¢ channels (0)             - Marketing channels          â”‚  â”‚
â”‚  â”‚  â€¢ campaigns (0)            - Marketing campaigns         â”‚  â”‚
â”‚  â”‚  â€¢ pixels (0)               - Tracking pixels             â”‚  â”‚
â”‚  â”‚  â€¢ link_pixels (0)          - Link-pixel junction         â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  Functions:                                                â”‚  â”‚
â”‚  â”‚  â€¢ generate_short_code()    - Generate random code        â”‚  â”‚
â”‚  â”‚  â€¢ increment_daily_analytics() - Update analytics         â”‚  â”‚
â”‚  â”‚  â€¢ update_updated_at_column() - Timestamp trigger         â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  Security:                                                 â”‚  â”‚
â”‚  â”‚  â€¢ Row Level Security (RLS) enabled                       â”‚  â”‚
â”‚  â”‚  â€¢ User-based access control                              â”‚  â”‚
â”‚  â”‚  â€¢ Public click insertion                                 â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚                                   â”‚
â”‚                              â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Realtime Subscriptions                        â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  â€¢ postgres_changes (INSERT on clicks)                    â”‚  â”‚
â”‚  â”‚  â€¢ postgres_changes (ALL on analytics_daily)              â”‚  â”‚
â”‚  â”‚  â€¢ Live updates to frontend                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Data Flow Diagrams

### 1. Creating a Short Link

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User  â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
    â”‚ Enter URL + Settings
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LinkShortener  â”‚ (Component)
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚ useLinks.shortenUrl()
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Supabase Client      â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚ functions.invoke('shorten-url')
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Edge Function           â”‚
â”‚ shorten-url/index.ts    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. Validate URL         â”‚
â”‚ 2. Generate short code  â”‚â”€â”€â”€â”€â”€â”€â”
â”‚    (call DB function)   â”‚      â”‚
â”‚ 3. Hash password        â”‚      â”‚
â”‚ 4. Create link record   â”‚â—„â”€â”€â”€â”€â”€â”˜
â”‚ 5. Attach pixels        â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PostgreSQL         â”‚
â”‚  INSERT INTO links  â”‚
â”‚  INSERT INTO pixels â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚ Return link data
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend      â”‚
â”‚  Update state  â”‚
â”‚  Show success  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 2. Clicking a Short Link (with Analytics)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User  â”‚ Clicks: https://247l.ink/s/jQ5SaM
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Browser loads  â”‚
â”‚ /s/jQ5SaM      â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Redirect.tsx   â”‚ (React Component)
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚ supabase.functions.invoke('track-click', { code: 'jQ5SaM' })
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Edge Function                 â”‚
â”‚ track-click/index.ts          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. Fetch link by short_code  â”‚â—„â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Check status/expiration   â”‚       â”‚
â”‚ 3. Check password            â”‚       â”‚
â”‚ 4. Get user IP               â”‚       â”‚
â”‚ 5. Fetch geolocation         â”‚â”€â”€â”€â”€â”€â”€â”€â”¤â”€â”€â”€ ipapi.co
â”‚ 6. Parse user agent          â”‚       â”‚
â”‚ 7. Check if unique (24h)     â”‚       â”‚
â”‚ 8. INSERT click record       â”‚â”€â”€â”€â”€â”€â”€â”€â”¤â”€â”€â”
â”‚    - destination_url = link.original_url â”‚  â”‚
â”‚ 9. Call increment_daily_analytics()â”‚â—„â”€â”€â”€â”€â”€â”˜  â”‚
â”‚ 10. Return redirect URL      â”‚               â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
    â”‚ { redirect: true, url: "https://..." }   â”‚
    â–¼                                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚ Redirect.tsx   â”‚                             â”‚
â”‚ window.location.href = url                   â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
    â”‚                                           â”‚
    â–¼                                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Destination    â”‚                    â”‚  PostgreSQL      â”‚
â”‚ Website        â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚ clicks table:    â”‚
                                      â”‚  â€¢ link_id       â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â€¢ ip_address    â”‚
    â”‚ Real-time subscription          â”‚  â€¢ country       â”‚
    â”‚                                 â”‚  â€¢ city          â”‚
    â–¼                                 â”‚  â€¢ device_type   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚  â€¢ browser       â”‚
â”‚ Frontend (Owner)   â”‚                â”‚  â€¢ destination_urlâ”‚
â”‚ useLinks hook      â”‚                â”‚  â€¢ created_at    â”‚
â”‚ - Receives event   â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ - Updates counter  â”‚                           â”‚
â”‚ - Shows in stats   â”‚                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â–¼
                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                      â”‚ analytics_daily: â”‚
                                      â”‚  â€¢ total_clicks++â”‚
                                      â”‚  â€¢ unique_clicks++â”‚
                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 3. Real-time Analytics Updates

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Link Owner        â”‚ Viewing Statistics page
â”‚   (Dashboard)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ Opens /statistics/:linkId
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Statistics.tsx          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. Fetch link data       â”‚
â”‚ 2. Fetch clicks          â”‚
â”‚ 3. Fetch analytics_daily â”‚
â”‚ 4. Calculate metrics     â”‚
â”‚ 5. Render charts/maps    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ Setup subscription
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Supabase Realtime                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ channel('link-analytics-123')    â”‚
â”‚                                   â”‚
â”‚ ON 'INSERT' in clicks             â”‚
â”‚   WHERE link_id = 123            â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
â”‚                                   â”‚
â”‚ ON '*' in analytics_daily        â”‚
â”‚   WHERE link_id = 123            â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ New click event received
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend Callback       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. fetchLinkAnalytics()  â”‚
â”‚ 2. Update charts         â”‚
â”‚ 3. Update counters       â”‚
â”‚ 4. Add to recent activityâ”‚
â”‚                          â”‚
â”‚ Result: LIVE UPDATES! âœ¨ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Security Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Security Layers                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  Layer 1: Frontend (Anon Key)                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ â€¢ Limited permissions                              â”‚    â”‚
â”‚  â”‚ â€¢ Can read public data                             â”‚    â”‚
â”‚  â”‚ â€¢ Can insert into public tables                    â”‚    â”‚
â”‚  â”‚ â€¢ Cannot bypass RLS                                â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                              â”‚
â”‚  Layer 2: Row Level Security (RLS)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ links:                                             â”‚    â”‚
â”‚  â”‚   SELECT: auth.uid() = user_id OR user_id IS NULL â”‚    â”‚
â”‚  â”‚   INSERT: auth.uid() = user_id OR user_id IS NULL â”‚    â”‚
â”‚  â”‚   UPDATE: auth.uid() = user_id                     â”‚    â”‚
â”‚  â”‚   DELETE: auth.uid() = user_id                     â”‚    â”‚
â”‚  â”‚                                                     â”‚    â”‚
â”‚  â”‚ clicks:                                            â”‚    â”‚
â”‚  â”‚   SELECT: EXISTS(link ownership check)            â”‚    â”‚
â”‚  â”‚   INSERT: true (public)                           â”‚    â”‚
â”‚  â”‚                                                     â”‚    â”‚
â”‚  â”‚ domains/channels/campaigns/pixels:                â”‚    â”‚
â”‚  â”‚   ALL: auth.uid() = user_id                       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                              â”‚
â”‚  Layer 3: Edge Functions (Service Role Key)                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ â€¢ Full database access                             â”‚    â”‚
â”‚  â”‚ â€¢ Bypasses RLS                                     â”‚    â”‚
â”‚  â”‚ â€¢ Used for system operations                       â”‚    â”‚
â”‚  â”‚ â€¢ Never exposed to client                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                              â”‚
â”‚  Layer 4: Application Logic                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ â€¢ Password hashing (SHA-256)                       â”‚    â”‚
â”‚  â”‚ â€¢ Input validation                                 â”‚    â”‚
â”‚  â”‚ â€¢ Status checks (active/expired)                   â”‚    â”‚
â”‚  â”‚ â€¢ Rate limiting (TODO)                             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ Component Hierarchy

```
App.tsx
â”œâ”€â”€ QueryClientProvider
â”‚   â””â”€â”€ AuthProvider
â”‚       â””â”€â”€ TooltipProvider
â”‚           â””â”€â”€ BrowserRouter
â”‚               â””â”€â”€ Routes
â”‚                   â”œâ”€â”€ /auth â†’ AuthPage
â”‚                   â”‚   â”œâ”€â”€ LoginForm
â”‚                   â”‚   â””â”€â”€ RegisterForm
â”‚                   â”‚
â”‚                   â”œâ”€â”€ / â†’ Index (Protected)
â”‚                   â”‚   â”œâ”€â”€ Navbar
â”‚                   â”‚   â”œâ”€â”€ TrafficOverview
â”‚                   â”‚   â”‚   â”œâ”€â”€ DailyClicksChart
â”‚                   â”‚   â”‚   â””â”€â”€ StatsCards
â”‚                   â”‚   â””â”€â”€ LinkShortener
â”‚                   â”‚       â”œâ”€â”€ QuickShortenerModal
â”‚                   â”‚       â”œâ”€â”€ LinksList
â”‚                   â”‚       â”‚   â”œâ”€â”€ LinkCard
â”‚                   â”‚       â”‚   â”‚   â”œâ”€â”€ EditUrlModal
â”‚                   â”‚       â”‚   â”‚   â””â”€â”€ BulkActions
â”‚                   â”‚       â”‚   â””â”€â”€ Pagination
â”‚                   â”‚       â””â”€â”€ RecentActivitySidebar
â”‚                   â”‚
â”‚                   â”œâ”€â”€ /statistics/:linkId â†’ Statistics
â”‚                   â”‚   â”œâ”€â”€ Navbar
â”‚                   â”‚   â”œâ”€â”€ LinkHeader
â”‚                   â”‚   â”œâ”€â”€ MetricsCards (4 cards)
â”‚                   â”‚   â”œâ”€â”€ DailyClicksChart
â”‚                   â”‚   â”œâ”€â”€ RecentActivity
â”‚                   â”‚   â”‚   â””â”€â”€ ViewAllActivityModal
â”‚                   â”‚   â”œâ”€â”€ WorldMap
â”‚                   â”‚   â”œâ”€â”€ PlatformsAnalytics
â”‚                   â”‚   â””â”€â”€ BrowserAnalytics
â”‚                   â”‚
â”‚                   â”œâ”€â”€ /statistics â†’ GlobalStatistics
â”‚                   â”‚   â””â”€â”€ (Similar to Statistics)
â”‚                   â”‚
â”‚                   â”œâ”€â”€ /archives â†’ Archives
â”‚                   â”‚   â””â”€â”€ ArchivedLinksList
â”‚                   â”‚
â”‚                   â””â”€â”€ /s/:shortCode â†’ Redirect
â”‚                       â”œâ”€â”€ Loading State
â”‚                       â”œâ”€â”€ PasswordGate (if protected)
â”‚                       â””â”€â”€ Error State
```

---

## ğŸ”„ State Management

```
Global State (via React Query)
â”œâ”€â”€ useLinks()
â”‚   â”œâ”€â”€ State:
â”‚   â”‚   â”œâ”€â”€ links: Link[]
â”‚   â”‚   â”œâ”€â”€ loading: boolean
â”‚   â”‚   â”œâ”€â”€ page: number
â”‚   â”‚   â””â”€â”€ hasMore: boolean
â”‚   â””â”€â”€ Actions:
â”‚       â”œâ”€â”€ shortenUrl()
â”‚       â”œâ”€â”€ deleteLink()
â”‚       â”œâ”€â”€ refreshLinks()
â”‚       â”œâ”€â”€ nextPage()
â”‚       â””â”€â”€ prevPage()
â”‚
â”œâ”€â”€ useAnalytics()
â”‚   â”œâ”€â”€ State:
â”‚   â”‚   â”œâ”€â”€ analytics: AnalyticsData
â”‚   â”‚   â”œâ”€â”€ recentActivity: Activity[]
â”‚   â”‚   â””â”€â”€ loading: boolean
â”‚   â””â”€â”€ Actions:
â”‚       â”œâ”€â”€ refreshAnalytics()
â”‚       â””â”€â”€ refreshActivity()
â”‚
â”œâ”€â”€ useDomains()
â”‚   â””â”€â”€ CRUD operations for domains
â”‚
â”œâ”€â”€ useCampaigns()
â”‚   â””â”€â”€ CRUD operations for campaigns
â”‚
â”œâ”€â”€ useChannels()
â”‚   â””â”€â”€ CRUD operations for channels
â”‚
â””â”€â”€ usePixels()
    â””â”€â”€ CRUD operations for pixels

Authentication State (via AuthProvider)
â”œâ”€â”€ user: User | null
â”œâ”€â”€ loading: boolean
â””â”€â”€ Context consumed by useAuth()

Real-time Subscriptions
â”œâ”€â”€ Links Subscription
â”‚   â””â”€â”€ Updates link stats on new clicks
â”‚
â””â”€â”€ Analytics Subscription
    â””â”€â”€ Updates analytics on new data
```

---

## ğŸŒ API Flow

### REST API (via Supabase Client)

```
supabase
  .from('table_name')
  .select('*')
  .eq('column', 'value')
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
                                   PostgreSQL
                                   + RLS Check
  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Response: { data, error }
```

### Edge Functions

```
supabase.functions.invoke('function-name', {
  body: { ... },
  headers: { ... }
})
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
                                   Edge Function (Deno)
                                   + Business Logic
                                   + Database Operations
  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Response: { data, error }
```

### Real-time Subscriptions

```
supabase
  .channel('channel-name')
  .on('postgres_changes', { ... }, callback)
  .subscribe()
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
                                   Supabase Realtime
                                   + WebSocket Connection
  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Event: { new, old, eventType }
  
Triggers callback on database changes
```

---

## ğŸ“ˆ Analytics Pipeline

```
Click Event
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ track-click     â”‚
â”‚ Edge Function   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â”€â–º INSERT into clicks table
     â”‚    â€¢ ip_address
     â”‚    â€¢ country, city
     â”‚    â€¢ device_type
     â”‚    â€¢ browser, os
     â”‚    â€¢ destination_url â­
     â”‚    â€¢ is_unique
     â”‚
     â””â”€â”€â–º Call increment_daily_analytics()
          â€¢ Updates analytics_daily
          â€¢ Increments total_clicks
          â€¢ Increments unique_clicks (if unique)
     
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Real-time Event         â”‚
â”‚ (Supabase Subscription) â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend Updates        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Link counter ++       â”‚
â”‚ â€¢ Recent activity       â”‚
â”‚ â€¢ Chart updates         â”‚
â”‚ â€¢ Map updates           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¨ UI Component Library

```
shadcn/ui Components Used:
â”œâ”€â”€ Navigation
â”‚   â”œâ”€â”€ Button
â”‚   â”œâ”€â”€ Navbar
â”‚   â””â”€â”€ Breadcrumb
â”‚
â”œâ”€â”€ Data Display
â”‚   â”œâ”€â”€ Card
â”‚   â”œâ”€â”€ Badge
â”‚   â”œâ”€â”€ Table
â”‚   â”œâ”€â”€ Tabs
â”‚   â”œâ”€â”€ Tooltip
â”‚   â”œâ”€â”€ Avatar
â”‚   â””â”€â”€ Separator
â”‚
â”œâ”€â”€ Forms
â”‚   â”œâ”€â”€ Input
â”‚   â”œâ”€â”€ Textarea
â”‚   â”œâ”€â”€ Select
â”‚   â”œâ”€â”€ Checkbox
â”‚   â”œâ”€â”€ Switch
â”‚   â”œâ”€â”€ Calendar
â”‚   â””â”€â”€ Form (react-hook-form)
â”‚
â”œâ”€â”€ Feedback
â”‚   â”œâ”€â”€ Toast (Sonner)
â”‚   â”œâ”€â”€ Alert
â”‚   â”œâ”€â”€ Progress
â”‚   â””â”€â”€ Skeleton
â”‚
â”œâ”€â”€ Overlay
â”‚   â”œâ”€â”€ Dialog
â”‚   â”œâ”€â”€ Modal
â”‚   â”œâ”€â”€ Popover
â”‚   â”œâ”€â”€ Dropdown Menu
â”‚   â””â”€â”€ Sheet
â”‚
â””â”€â”€ Visualization
    â”œâ”€â”€ Chart (Recharts)
    â””â”€â”€ Map (react-simple-maps)
```

---

*Diagram created: November 10, 2025*

